/***********************************************************************
/* IPCALC
/***********************************************************************
sudo pacman --sync --needed ipcalc

# можно расшифровывать сетевые маски
ipcalc 192.168.10.0/24
ipcalc 10.0.0.0/8

/***********************************************************************
/* resolv
/***********************************************************************
resolve реализуемый glibc, и наверное, совместимыми реализациями стандартной библиотеки C + POSIX - настравивается файлом /etc/resolv.conf:


/***********************************************************************
/* ip utility stuff
/***********************************************************************
Описание утилиты ip в man ip + подкомманды: man ip-address, man ip-link, etc
 Увы man pages оставляют желать лучшего. 
 Еще есть книга/руководство написанное автором утилиты ip и одним из ключевых разработчиков сетевого стека linux, гуглится по ip-cref
 А еще есть интересное интервью, там нет ничего по документации - но просто интересно почитать: https://www.opennet.ru/opennews/art.shtml?num=38016

ip link show  # показать сетевые интерфейсы
ip addr show  # показать сетевые интерфейсы и их адресса

ip route list         # показать таблицу маршрутизации
ip route add/del ...  # добавить/удалить записи

# примеры

ip route del default via 192.168.16.1 dev tun0       # удаляем дефолтный не нужный маршрут через vpn тунель
ip route add 192.168.0.0/16 dev tun0                 # 192.168.0.0/16 напрямую в тунель
ip route add 10.0.0.0/8 dev tun0                     # 10.0.0.0/8     напрямую в тунель
ip route add 10.6.0.0/16 via 192.168.8.8 dev enp4s0  # 10.6.0.0/16 через gateway по адресу 192.168.8.8 и интерфейс enp4s0

А еще ip умеет в цвета, но только если у него попросить :)
ip -color addr
ip -color -brief addr
ip -c -br addr


iptables работает вместе с ip route маршрутизацией(смотри картинки в кингах/интернете), некоторые полезные книги:
https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html   (Iptables Tutorial 1.2.2)
http://www.policyrouting.org/PolicyRoutingBook/ONLINE/TOC.html       (нужно бы найти в pdf/fb2)
https://www.linuxjournal.com/content/linux-advanced-routing-tutorial

iproute2 маршрутизирует вообще все сообщения, и созданные на этой машине и пришедшие из вне, не нам.
ip route маршрутизирует по destination adress

ip rule же позволяет, по факту, маршрутизировать по source adress, портам и еще ряду свойств, впрочем возможности несколько ограничены.
ip rule задает условия и результирующую таблицу для дальнейшего роутинга, все вместе это называется policy routing

iptables следует вызывать с ключом -v тогда он показывает доп информация, а именно интерфейсы, что вообще-то важно.

/***********************************************************************
/* link-local discovery
/***********************************************************************
ping -6 -b ff02::1%enp5s0
ip -6 neigh

ssh -6 "fe02::...:...:...%dev"

# regular copy utilities
rsync/scp  file   user@"[fe02::..:...%dev]"
# devices can be transfered
ssh user@addr%dev "cat > out-path" < in-path
sudo dd if=/dev/sde status=progress bs=8M | xz | ssh -T host 'cat > out-path.iso.xz'


/***********************************************************************
/* Host model
/***********************************************************************
https://en.wikipedia.org/wiki/Host_model
In computer networking, a host model is an option of designing the TCP/IP stack of a networking operating system like Microsoft Windows or Linux.
When a unicast packet arrives at a host, IP must determine whether the packet is locally destined (its destination matches an address that is assigned to an interface of the host).
If the IP stack is implemented with a weak host model, it accepts any locally destined packet regardless of the network interface on which the packet was received.
If the IP stack is implemented with a strong host model, it only accepts locally destined packets if the destination IP address in the packet matches an IP address
assigned to the network interface on which the packet was received.

The weak host model provides better network connectivity (for example, it can be easy to find any packet arriving at the host using ordinary tools),
but it also makes hosts susceptible to multihome-based network attacks. For example, in some configurations when a system running a weak host model is connected to a VPN,
other systems on the same subnet can compromise the security of the VPN connection. Systems running the strong host model are not susceptible to this type of attack.

The IPv4 implementation in Microsoft Windows versions prior to Windows Vista uses the weak host model.
The Windows Vista and Windows Server 2008 TCP/IP stack supports the strong host model for both IPv4 and IPv6 and is configured to use it by default.
However, it can also be configured to use a weak host model.

The IPv4 implementation in Linux defaults to the weak host model. Source validation by reversed path, as specified in RFC 1812 can be enabled (the rp_filter option),
and some distributions do so by default. This is not quite the same as the strong host model, but defends against the same class of attacks for typical multihomed hosts.
arp_ignore and arp_announce can also be used to tweak this behaviour.

Modern BSDs (FreeBSD, NetBSD, OpenBSD, and DragonflyBSD) all default to the weak host model. 
OpenBSD since 6.6-current supports strong host model by default "if and only IP forwarding is disabled",
with IP forwarding enabled (and for older versions) it supports reversed path source validation via its pf firewall,
using the urpf-failed option, while Free-, Net-, and DragonflyBSD provide a global sysctl options.


/***********************************************************************
/* Host model, Weak Model,
/* What determines if a packet should be routed locally or forwarded?
/***********************************************************************
https://superuser.com/a/1834520/385394 / https://superuser.com/questions/1834516/what-determines-if-a-packet-should-be-routed-locally-or-forwarded

Internally, it's all made according to the routing table.
Linux has an additional routing table, the local table, that has special routes for addresses belonging to the same system:

  $ ip route ls table local
  local 10.147.241.1 dev mlx0 proto kernel scope host

Its contents are automatically generated from IP addresses assigned to interfaces.

from man ip-route
    scope SCOPE_VAL
        the scope of the destinations covered by the route prefix. SCOPE_VAL may be a number or a string from /usr/share/iproute2/rt_scopes or /etc/iproute2/rt_scopes (has precedence if  exists).
        If  this  parameter  is omitted, ip assumes scope global for all gatewayed unicast routes, scope link for direct unicast and broadcast routes and scope host for local routes.

!! So looks like "scope host" does directs packets into this host, INPUT iptables chains and and in the end into application(if any)



